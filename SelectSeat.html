<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="SelectSeat.css" />
    <title>Select Seat</title>
  </head>
 
  <body>
    <div class="movie-container">
      <!--<label> Select a movie:</label> -->
      <select id="movie">
        <!-- <option value="15">Aquaman 2 (RM15)</option>
        <option value="20">Pendekar Awang (RM20)</option>
        <option value="20">KL Anarki (RM20)</option>
        <option value="15">Polis Evo 3 (RM15)</option> -->
      </select>
    </div>

    <ul class="showcase">
      <li>
        <div class="seat"></div>
        <small>Available</small>
      </li>
      <li>
        <div class="seat selected"></div>
        <small>Selected</small>
      </li>
      <li>
        <div class="seat sold"></div>
        <small>Sold</small>
      </li>
    </ul>
    <div class="container">
      <div class="screen"></div>
      <div class="row">
        <div class="seat"><span id="selectedSeatData">A01</span></div>
        <div class="seat"><span id="selectedSeatData">A02</span></div>
		<div class="seat sold"><span id="selectedSeatData">A03</span></div>
        <div class="seat sold"><span id="selectedSeatData">A04</span></div>
        <div class="seat sold"><span id="selectedSeatData">A05</span></div>
        <div class="seat sold"><span id="selectedSeatData">A06</span></div>
        <div class="seat sold"><span id="selectedSeatData">A07</span></div>
        <div class="seat"><span id="selectedSeatData">A08</span></div>
		<div class="seat"><span id="selectedSeatData">A09</span></div>
        <div class="seat"><span id="selectedSeatData">A10</span></div>
		<div class="seat"><span id="selectedSeatData">A11</span></div>
		<div class="seat"><span id="selectedSeatData">A12</span></div>
        <div class="seat"><span id="selectedSeatData">A13</span></div>
        <div class="seat"><span id="selectedSeatData">A14</span></div>
      </div>
      <div class="row">
        <div class="seat"><span id="selectedSeatData">B01</span></div>
        <div class="seat"><span id="selectedSeatData">B02</span></div>
        <div class="seat"><span id="selectedSeatData">B03</span></div>
		<div class="seat"><span id="selectedSeatData">B04</span></div>
        <div class="seat"><span id="selectedSeatData">B05</span></div>
        <div class="seat"><span id="selectedSeatData">B06</span></div>
		<div class="seat"><span id="selectedSeatData">B07</span></div>
        <div class="seat"><span id="selectedSeatData">B08</span></div>
        <div class="seat"><span id="selectedSeatData">B09</span></div>
        <div class="seat"><span id="selectedSeatData">B10</span></div>
        <div class="seat"><span id="selectedSeatData">B11</span></div>
        <div class="seat"><span id="selectedSeatData">B12</span></div>
        <div class="seat sold"><span id="selectedSeatData">B13</span></div>
        <div class="seat sold"><span id="selectedSeatData">B14</span></div>
      </div>
      <div class="row">
	   <div class="seat"><span id="selectedSeatData">C01</span></div>
        <div class="seat"><span id="selectedSeatData">C02</span></div>
        <div class="seat"><span id="selectedSeatData">C03</span></div>
		<div class="seat"><span id="selectedSeatData">C04</span></div>
        <div class="seat sold"><span id="selectedSeatData">C05</span></div>
        <div class="seat sold"><span id="selectedSeatData">C06</span></div>
        <div class="seat sold"><span id="selectedSeatData">C07</span></div>
		<div class="seat"><span id="selectedSeatData">C08</span></div>
        <div class="seat"><span id="selectedSeatData">C09</span></div>
        <div class="seat"><span id="selectedSeatData">C10</span></div>
        <div class="seat"><span id="selectedSeatData">C11</span></div>
        <div class="seat"><span id="selectedSeatData">C12</span></div>
        <div class="seat"><span id="selectedSeatData">C13</span></div>
        <div class="seat"><span id="selectedSeatData">C14</span></div>
      </div>
      <div class="row">
        <div class="seat"><span id="selectedSeatData">D01</span></div>
        <div class="seat"><span id="selectedSeatData">D02</span></div>
        <div class="seat"><span id="selectedSeatData">D03</span></div>
		<div class="seat"><span id="selectedSeatData">D04</span></div>
        <div class="seat"><span id="selectedSeatData">D05</span></div> 
		<div class="seat"><span id="selectedSeatData">D06</span></div>
        <div class="seat"><span id="selectedSeatData">D07</span></div>
        <div class="seat"><span id="selectedSeatData">D08</span></div>
        <div class="seat"><span id="selectedSeatData">D09</span></div>
        <div class="seat sold"><span id="selectedSeatData">D10</span></div>
        <div class="seat sold"><span id="selectedSeatData">D11</span></div>
        <div class="seat"><span id="selectedSeatData">D12</span></div>
        <div class="seat"><span id="selectedSeatData">D13</span></div>
        <div class="seat"><span id="selectedSeatData">D14</span></div>
      </div>
      <div class="row">
        <div class="seat sold"><span id="selectedSeatData">E01</span></div>
        <div class="seat sold"><span id="selectedSeatData">E02</span></div>
        <div class="seat"><span id="selectedSeatData">E03</span></div>
        <div class="seat"><span id="selectedSeatData">E04</span></div>
		<div class="seat"><span id="selectedSeatData">E05</span></div>
        <div class="seat"><span id="selectedSeatData">E06</span></div>
        <div class="seat"><span id="selectedSeatData">E07</span></div>
        <div class="seat"><span id="selectedSeatData">E08</span></div>
		<div class="seat"><span id="selectedSeatData">E09</span></div>
        <div class="seat"><span id="selectedSeatData">E10</span></div>
        <div class="seat sold"><span id="selectedSeatData">E11</span></div>
        <div class="seat sold"><span id="selectedSeatData">E12</span></div>
        <div class="seat sold"><span id="selectedSeatData">E13</span></div>
        <div class="seat"><span id="selectedSeatData">E14</span></div>
      </div>
    </div>

    <p class="text">
      You have selected <span id="count">0</span> seats <!--seat for a price of RM<span
        id="total"
        >0</span>-->
    </p>
	<br>
	
	<!-- navigate to another page confirmseat() -->
  <button type="button" onclick="confirmSeat()">
    <div class='button'>Confirm Seat</div>
  </button>

  <script>
    const container = document.querySelector(".container");
    const seats = document.querySelectorAll(".row .seat:not(.sold)");
    const count = document.getElementById("count");
    /*const total = document.getElementById("total");*/
    const movieSelect = document.getElementById("movie");

    populateUI();

    let ticketPrice = +movieSelect.value;

    // Save selected movie index and price
    function setMovieData(movieIndex, moviePrice) {
      localStorage.setItem("selectedMovieIndex", movieIndex);
      localStorage.setItem("selectedMoviePrice", moviePrice);
    }

    // Update total and count
    function updateSelectedCount() {
      const selectedSeats = document.querySelectorAll(".row .seat.selected");

     const seatNumbers = [...selectedSeats].map(seat => seat.textContent);
	 localStorage.setItem("selectedSeats", JSON.stringify(seatNumbers));

      const selectedSeatsCount = selectedSeats.length;

      count.innerText = selectedSeatsCount;
      /*total.innerText = selectedSeatsCount * ticketPrice;*/

      setMovieData(movieSelect.selectedIndex, movieSelect.value);
    }

    // Get data from localstorage and populate UI
    function populateUI() {
      const selectedSeatNumbers = JSON.parse(localStorage.getItem("selectedSeats"));

	if (selectedSeatNumbers !== null && selectedSeatNumbers.length > 0) {
    seats.forEach((seat) => {
        const seatNumber = seat.textContent;
        if (selectedSeatNumbers.includes(seatNumber)) {
            seat.classList.add("selected");
        }
    });
}

      const selectedMovieIndex = localStorage.getItem("selectedMovieIndex");

      if (selectedMovieIndex !== null) {
        movieSelect.selectedIndex = selectedMovieIndex;
      }
    }

    // Movie select event
    movieSelect.addEventListener("change", (e) => {
      ticketPrice = +e.target.value;
      setMovieData(e.target.selectedIndex, e.target.value);
      updateSelectedCount();
    });

    // Seat click event
    container.addEventListener("click", (e) => {
      if (
        e.target.classList.contains("seat") &&
        !e.target.classList.contains("sold")
      ) {
        e.target.classList.toggle("selected");
        updateSelectedCount();
      }
    });

    // Function to be called when the Confirm Seat button is clicked
    function confirmSeat() {
      // Update the total and count before submitting the form
      updateSelectedCount();

      // Create a form element
      const form = document.createElement('form');
      form.setAttribute('method', 'post');
      form.setAttribute('action', 'ProceedTicket.html');

      // Create a hidden input for selected seat data
      const seatInput = document.createElement('input');
      seatInput.setAttribute('type', 'hidden');
      seatInput.setAttribute('name', 'selectedSeatData');
      seatInput.setAttribute('value', JSON.stringify(localStorage.getItem('selectedSeats')));

      // Append the input to the form
      form.appendChild(seatInput);

      // Append the form to the document and submit it
      document.body.appendChild(form);
      form.submit();
    }
	
	document.addEventListener('DOMContentLoaded', function () {
    const selectedContainers = JSON.parse(localStorage.getItem('selectedContainers'));

    if (selectedContainers && selectedContainers.length > 0) {
        // Use the selectedContainers as needed
        console.log('Selected Containers:', selectedContainers);
    } else {
        // Handle the case when no containers are selected
        console.log('No selected containers found.');
    }
});

  </script>
</body>
<footer>
  <div class="footer">
    <p>BIOSCOPE Â©2023</p>
  </div>
</footer>
</html>